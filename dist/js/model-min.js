function markerKeywordMatch(keyword){vm.removeSearchResults();for(var i=0;i<mapPins.length;i++)mapPins[i].matchKeyword(keyword)?(mapPins[i].setSelected(!0),vm.addSearchResult(mapPins[i])):mapPins[i].setSelected(!1)}function markerTitleMatch(match){vm.removeSearchResults();for(var i=0;i<mapPins.length;i++)mapPins[i].matchTitle(match)?(mapPins[i].setSelected(!0),vm.addSearchResult(mapPins[i])):mapPins[i].setSelected(!1)}function searchYelp(mapPin,returnValues){yelpSearch("restaurant",mapPin.place.title,function(yelpResult){for(var i=0;i<yelpResult.businesses.length;i++)returnValues.push({name:yelpResult.businesses[i].name,text:yelpResult.businesses[i].snippet_text,imageUrl:imageUrl(yelpResult.businesses[i].snippet_image_url),url:yelpResult.businesses[i].url,link:yelpResult.businesses[i].name});showMapInfoWindow(mapPin,"#yelpInfoWindow")},function(textStatus,errorThrown){returnValues.push({name:textStatus,text:errorThrown,imageUrl:"images/connect-error.png",url:"",link:""}),showMapInfoWindow(mapPin,"#yelpInfoWindow")})}function searchMeetup(mapPin,returnValues){var description="",address="",city="";meetupSearch(mapPin.place,function(meetupResult){for(var i=0;i<meetupResult.results.length;i++)description=void 0===meetupResult.results[i].description?meetupResult.results[i].description:meetupResult.results[i].description.substring(0,100)+" ...",void 0!==meetupResult.results[i].venue&&(address=meetupResult.results[i].venue.address_1,city=meetupResult.results[i].venue.city),returnValues.push({name:meetupResult.results[i].name,description:description,address:address,city:city,time:new Date(meetupResult.results[i].time).toLocaleString(),event_url:meetupResult.results[i].event_url,urlname:meetupResult.results[i].group.urlname});0===meetupResult.results.length&&returnValues.push({name:"No meeetup in this area.",description:"",city:"",time:"",url:"",address:"",event_url:"",urlname:""}),showMapInfoWindow(mapPin,"#meetupInfoWindow")},function(textStatus,errorThrown){returnValues.push({name:textStatus,description:errorThrown,city:"",time:"",url:"",address:"",event_url:"",urlname:""}),showMapInfoWindow(mapPin,"#meetupInfoWindow")})}var map,mapPins=[],selectedMapPin=null,infoWindow,initialIcon=null;initMap=function(){var center={lat:46.78000496,lng:8.37522517};for(map=new google.maps.Map(document.getElementById("map"),{zoom:8,center:center}),infoWindow=new google.maps.InfoWindow({maxWidth:300,maxHight:600,content:'<div id="content" class="info_window"><p>data load failed<p></p></div>'}),i=0;i<placesModel.placesList.length;i++)mapPin=new MapPin(map,placesModel.placesList[i]),mapPins.push(mapPin),vm.addSearchResult(mapPin)};var MapPin=function(map,place){this.map=map,this.place=place,this.marker=new google.maps.Marker({position:place,map:map,title:place.title,animation:null,icon:"images/"+place.keyword[0]+".png"}),this.marker.addListener("click",function(){vm.showInfoWindowFoward(this)}.bind(this))};MapPin.prototype.markSelected=function(){null!==selectedMapPin&&selectedMapPin.marker.setZIndex(google.maps.Marker.MAX_ZINDEX-1),selectedMapPin=this,map.setCenter({lat:this.place.lat,lng:this.place.lng+.6}),this.marker.setZIndex(google.maps.Marker.MAX_ZINDEX+1),this.marker.setAnimation(google.maps.Animation.BOUNCE),mapPinAnnimation(this.marker,1500)},mapPinAnnimation=function(aMarker,aTime){var marker=aMarker,time=aTime;setTimeout(function(){marker.setAnimation(google.maps.Animation.NONE)},time)},MapPin.prototype.matchKeyword=function(keyword){for(var i=0;i<this.place.keyword.length;i++){if("all"===keyword)return!0;if(keyword===this.place.keyword[i])return!0}return!1},MapPin.prototype.matchTitle=function(matchString){return-1!=this.place.title.toLowerCase().indexOf(matchString.toLowerCase())?!0:!1},MapPin.prototype.setSelected=function(selected){selected?this.marker.setMap(map):this.marker.setMap(null)},showMapInfoWindow=function(mapPin,nodeId){var node=$(nodeId).clone();infoWindow.setContent(node.html()),infoWindow.open(map,mapPin.marker)};